{
  "long_term_memory": "Data model:\n- Prisma schema: User, Agent, Customer, Message, Driver, Vehicle, AdminUser, AuditLog, ProfileShare.\n- User has emailVerified boolean for OTP verification.\n- User includes totpEnabled, encrypted totpSecret, unique totpRecoveryId, totpBackupCodes, totpBackupCodesUpdatedAt for authenticator recovery.\n- PostgreSQL database via DATABASE_URL (dev + staging).\n- Agent/Customer list fields stored as JSON strings.\n- Customer no longer stores preferred agent or sharedWithAgent (internal preferred-agent flow removed).\n- ProfileShare stores token + code hash, sections, snapshot, editable flag, status, pending edits/status, optional recipient name, and last access time.\n\nAPIs:\n- Express server in connsura-backend/src/server.js.\n- CORS origin FRONTEND_URL (default http://localhost:5173).\n- Routes: /auth, /agents, /customers, /search, /quotes, /contact, /admin, /messages, /shares.\n- Auth OTP endpoints for logged-in users: POST /auth/email-otp/request and /auth/email-otp/confirm.\n- Auth recovery endpoints: POST /auth/totp/setup, /auth/totp/confirm, /auth/totp/backup-codes, /auth/totp/disable, /auth/recovery/reset (email or recovery ID + authenticator or backup code).\n- Share endpoints: POST /shares (create), POST /shares/:token/verify (code + optional name), POST /shares/:token/edits, POST /shares/:token/approve, POST /shares/:token/decline, POST /shares/:token/revoke, POST /shares/:token/close, GET /shares/pending, GET /shares/active.\n- Share creation requires emailVerified for customers.\n- Static: /uploads and /forms.\n- Agent endpoints include profile update, photo upload, SCC lookup, request flow.\n- Customer endpoints include profile read/update, photo upload, profileData patch.\n- Admin endpoints include login, OTP lookup, agent/client management, audit logs.\n\nRuntime:\n- Deploy env sets HOST=0.0.0.0, PORT=8000, FRONTEND_URL=https://<domain>, DATABASE_URL=postgresql://<user>:<password>@postgres:5432/<db> (from /opt/connsura/env/backend.env).\n- Admin seed runs if ADMIN_EMAIL/ADMIN_PASSWORD are set.\n- TOTP secrets are encrypted with TOTP_ENCRYPTION_KEY (fallback to JWT_SECRET).\n\nDecisions:\n- Serve uploads and forms directly from backend.\n- Auth recovery uses encrypted TOTP secrets and backup codes.\n- Staging deploys target AWS EC2 (us-east-1) with Elastic IP; deploy via automation/master.ps1 -SkipDns.\n\nOpen questions:\n- Production DB choice and migration strategy.\n- Logging/monitoring stack not defined.\n\nNext steps:\n- Keep API docs aligned with route changes.\n- Update memory after major backend changes.",
  "messages": [],
  "docs_index": {
    "embedding_model": "text-embedding-3-small",
    "chunks": []
  }
}